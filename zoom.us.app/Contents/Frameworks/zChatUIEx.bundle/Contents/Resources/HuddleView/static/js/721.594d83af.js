(self["webpackChunk_zoom_client_im_js"]=self["webpackChunk_zoom_client_im_js"]||[]).push([[721],{89721:function(e,t,i){"use strict";i.r(t),i.d(t,{__esModule:function(){return a.X},default:function(){return l}});var s=i(96279),a=i(83578),o=a.Z,d=i(1001),n=(0,d.Z)(o,s.sY,s.xk,!1,null,null,null),l=n.exports},83578:function(e,t,i){Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var s=i(89334),a=d(i(40766)),o=i(43259);function d(e){return e&&e.__esModule?e:{default:e}}var n={name:"background",mixins:[a.default],created(){document.title=this.$t("huddleViewtitle"),this.list=[],this.huddleViewBackgroundType=o.huddleViewBackgroundType,this.getValuePersistence(),this.getBackgroundMaxCount(),this.getFileTransferDisabled(),this.getChannelBackground(),this.getBackgroundList(),this.syncBackgroundLis(),this.$Bus.$on("zChatSDKJsAPI_huddleView_indicateBackgroundDownloaded",this.indicateBackgroundDownloaded),this.$Bus.$on("zChatSDKJsAPI_huddleView_indicateBackgroundUploaded",this.indicateBackgroundUploaded),this.$Bus.$on("zChatSDKJsAPI_huddleView_indicateCfgBackgroundUpdated",this.indicateCfgBackgroundUpdated),this.$Bus.$on("zChatSDKJsAPI_huddleView_indicateBackgroundDeleted",this.indicateBackgroundDeleted)},data(){return{previewValue:!1,imgs:[],currentFile:{localPath:""},selectItem:null,loaded:!1,loading:!0,showImg:!1,fileId:"",showErrorMsg:!1,showAdd:!0,customImageCount:0,downLoadReqId:"",currentBackInfo:{},groupMemberCount:15}},computed:{borderStyle(){return this.isWindows()?{}:{"border-radius":"12px",border:" 0.5px solid rgba(82, 82, 128, 0.18)","box-shadow":"0px 8px 24px rgba(35, 35, 51, 0.1)"}},getTitle(){return`${this.customImageCount} ${this.$t("backgroundLimitCountTitle")}`},disabled(){return!!this.imgs&&this.imgs.length>=this.groupMemberCount}},methods:{syncBackgroundLis(){window.zoomSdk.postJsMessage({functionName:"zChatSDKCppAPI_huddleView_syncBackgroundList",params:{},needResponse:!1})},onError(e){""!==e.fakeFileId&&(e.localPath="")},handleScroll(){this.scrollTop=this.$refs.imgContainer.scrollTop},getFileTransferDisabled(){window.zoomSdk.postJsMessage({functionName:"zChatSDKCppAPI_isFileTransferDisabled",params:{}}).then((e=>{0===e.returnCode&&(this.showAdd=e.result.value)}))},getBackgroundMaxCount(){window.zoomSdk.postJsMessage({functionName:"zChatSDKCppAPI_huddleView_getMaxCount",params:{}}).then((e=>{0===e.returnCode&&(this.customImageCount=e.result.customImageCount,this.groupMemberCount=e.result.groupMemberCount)}))},async handleDelete(e){if(!e.id)return;const t=await window.zoomSdk.postJsMessage({functionName:"getValuePersistence",params:{key:o.showDeleteTip}}),i="true"===t.result.value;i?(this.scrollTop=this.$refs.imgContainer.scrollTop,window.zoomSdk.postJsMessage({functionName:"zChatSDKCppAPI_huddleView_deleteBackground",params:{fileId:e.id}}).then((e=>{window.zoomLog({jsFunctionName:"zChatSDKCppAPI_huddleView_deleteBackground",params:e})}))):this.$deleteBox(`${this.$t("backgroundDelete")} "${e.name&&e.name.split(".")[0]}" ?`,{backgroundDeleteTip:this.$t("backgroundDeleteTip"),backgroundCancel:this.$t("backgroundCancel"),backgroundDelete:this.$t("backgroundDelete"),callback:t=>{"cancel"===t?console.log("cancel"):(this.scrollTop=this.$refs.imgContainer.scrollTop,window.zoomSdk.postJsMessage({functionName:"zChatSDKCppAPI_huddleView_deleteBackground",params:{fileId:e.id}}).then((e=>{window.zoomLog({jsFunctionName:"zChatSDKCppAPI_huddleView_deleteBackground",params:e})})))}})},openUpload(){this.showErrorMsg=!1,this.disabled||window.zoomSdk.postJsMessage({functionName:"didUploadCustomBackground",params:{sessionId:this.sessionId},noDelete:!0}).then((e=>{if(window.zoomLog({jsFunctionName:"didUploadCustomBackground",params:e}),0===e.returnCode){const t=e.result.filePath;window.zoomSdk.postJsMessage({functionName:"zChatSDKCppAPI_huddleView_uploadBackground",params:{path:t}}).then((async e=>{if(0===e.returnCode){const i=e.result,{reqId:s,fakeFileId:a}=i,o=await this.windowOrMacImagePath(t);this.imgs.push({localPath:o,reqId:s,fakeFileId:a,upload:!0}),this.$nextTick((()=>{const e=this.$refs[s][0],{top:t}=e.getBoundingClientRect();this.scrollTop=t,this.$refs.imgContainer.scrollTop=t}))}}))}else this.showErrorMsg=!0}))},isWindows(){return(0,s.isWindows)(window)},indicateBackgroundUploaded(e){const{jsFunctionName:t,params:i}=e;if("zChatSDKJsAPI_huddleView_indicateBackgroundUploaded"===t){const{result:e,fakeFileId:t,fileId:s}=i;if(0===e)this.imgs.forEach((async e=>{if(e.fakeFileId===t||e.fakeFileId===s){e.fakeFileId="";const t=await window.zoomSdk.postJsMessage({functionName:"zChatSDKCppAPI_getFileByWebFileId",params:{fileId:i.fileId}});if(0===t.returnCode){const{file:i}=t.result;e.id=i.id,e.type=i.type,e.name=i.name,e.localPath=await this.windowOrMacImagePath(i.localPath),e.isDownloaded=!0;const s=await window.zoomSdk.postJsMessage({functionName:"zChatSDKCppAPI_huddleView_getBackgroundById",params:{fileId:i.id}});0===s.returnCode&&this.$set(e,"huddleViewType",s.result.list[0].type)}}}));else{const e=this.imgs.findIndex((e=>e.fakeFileId===t||e.fakeFileId===s));-1!==e&&this.imgs.splice(e,1),this.showErrorMsg=!0}}},imgLoad(){this.loading=!1},changePosition(e){let{jid:t,top:i,left:s}=e;this.$backUsers(t,{top:i,left:s},"changePosition")},_useJidCreateUser(e){let{buddy:t,left:i,top:s,jid:a}=e;this.$backUsers(a,{sessionId:this.sessionId,ownerJid:this.ownerJid,_buddy:t,_left:i,_top:s,currentJid:a,isMain:!1})},_deleteUser(e){this.$backUsers(e,{},"remove")},getValuePersistence(){window.zoomSdk.postJsMessage({functionName:"getValuePersistence",params:{key:"previewValue"}}).then((e=>{0===e.returnCode&&(this.previewValue="true"===e.result.value||""===e.result.value)}))},setValuePersistence(e,t){window.zoomSdk.postJsMessage({functionName:"setValuePersistence",params:{key:e,value:t+""},needResponse:!1})},selectImg(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.fakeFileId||t&&!0===t.isApplySource||(this.currentFile=e,setTimeout((()=>{this.$refs[this.currentFile.id]&&this.$refs[this.currentFile.id][0]&&(this.$refs[this.currentFile.id][0].parentNode.parentNode.focus(),(0,s.isWindows)(window)||(0,s.speakAnnoce)(this.currentFile.name&&this.currentFile.name.split(".")[0]+", selected"))}),100))},handleDefaultBg(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e&&!0===e.isApplySource||(this.currentFile={localPath:i(72602)})},async handleBgImg(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(e.isDownloaded)return e.localPath=await this.windowOrMacImagePath(e.localPath),this.fileId=t,void this.selectImg(e,s);this.handleDefaultBg(s),await this.downLoadBackImg(t,i,s),s&&s.isApplySource?this.downLoadReqId="":this.downLoadReqId=t},handleChange(){this.setValuePersistence("previewValue",this.previewValue)},async getChannelBackground(){await this.getSessionId();const e=await window.zoomSdk.postJsMessage({functionName:"zChatSDKCppAPI_getGroupById",params:{groupId:this.sessionId}});if(e&&0===e.returnCode){var t,i,s,a,o,d,n;this.currentBackInfo=(null===(t=e.result.group)||void 0===t?void 0:t.background)||{};let l={isApplySource:!1,sourceFileId:"",appliedFileId:""};if(null!==(i=e.result)&&void 0!==i&&null!==(s=i.group)&&void 0!==s&&null!==(a=s.background)&&void 0!==a&&a.sourceFileId){const t=e.result.group.background,i=await window.zoomSdk.postJsMessage({functionName:"zChatSDKCppAPI_getFileByWebFileId",params:{fileId:t.sourceFileId}});if(0===i.returnCode&&i.result.file.isDownloaded){l.sourceFileId=t.sourceFileId,l.appliedFileId=t.appliedFileId,l.isApplySource=!0;let e=i.result.file;e.localPath=await this.windowOrMacImagePath(e.localPath),this.fileId=t.sourceFileId,this.currentFile={...e}}}null!==(o=e.result)&&void 0!==o&&null!==(d=o.group)&&void 0!==d&&null!==(n=d.background)&&void 0!==n&&n.appliedFileId||await this.getBackList(l),await this.getSrc(e.result.group.background.appliedFileId,e.result.group.background.type,l)}},diffOldListAndNewList(e,t){const i=[],s=[];return e.forEach((e=>{t.some((t=>t.fileId===e))||i.push(e)})),t.forEach((t=>{e.some((e=>t.fileId===e))||s.push(t)})),{addList:s,deleteList:i}},getBackgroundList(){this.getBackgroundImg("zChatSDKCppAPI_huddleView_getBackgroundList")},getBackgroundById(e){this.getBackgroundImg("zChatSDKCppAPI_huddleView_getBackgroundById",e)},getBackgroundImg(e,t){const i=t?{fileId:t}:{};window.zoomSdk.postJsMessage({functionName:e,params:i}).then((e=>{if(0===e.returnCode){const{list:t}=e.result,{deleteList:i,addList:s}=this.diffOldListAndNewList(this.list,t);this.list=t,i.forEach((e=>{this.deleteFromImgs(e)})),this.$refs.imgContainer.scrollTop=this.scrollTop||0,s.forEach((async(e,t)=>{let{status:i,fileId:s,uploadingPath:a,label:d,type:n}=e;i===o.backgroundStatus.READY?this.useFileIdGetBg(s,t,n):(this.downloadBackground({type:n,fileId:s}),this.handleImgs(s,{localPath:a,fakeFileId:s,name:d},t))})),console.log("this.imgs ----\x3e ",t)}}))},async downloadBackground(e){let{type:t,fileId:i,path:a}=e;if(!a){const e=await window.zoomSdk.postJsMessage({functionName:"zChatSDKCppAPI_huddleView_getBackgroundFolder",params:{}});0===e.returnCode&&(a=e.result.folder+"/"+(0,s.getUniqueId)())}a&&window.zoomSdk.postJsMessage({functionName:"zChatSDKCppAPI_huddleView_downloadBackground",params:{type:t,fileId:i,path:a}})},useFileIdGetBg(e,t,i){window.zoomSdk.postJsMessage({functionName:"zChatSDKCppAPI_getFileByWebFileId",params:{fileId:e}}).then((async s=>{if(0===s.returnCode){const a=s.result.file,{isDownloaded:o,localPath:d}=a;o?a.localPath=await this.windowOrMacImagePath(a.localPath):(a.fakeFileId=a.id,a.localPath=await this.windowOrMacImagePath(a.localPath),this.downloadBackground({type:i,fileId:e,path:d}));const n=await window.zoomSdk.postJsMessage({functionName:"zChatSDKCppAPI_huddleView_getBackgroundById",params:{fileId:a.id}});0===n.returnCode&&(a.huddleViewType=n.result.list[0].type),this.handleImgs(e,a,t)}}))},handleImgs(e,t,i){if("number"===typeof i)return this.$set(this.imgs,i,t);const s=this.imgs.findIndex((t=>t.id===e));t.isDownloaded||(t.fakeFileId=t.id,t.localPath=""),-1!==s?this.imgs.splice(s,1,t):this.imgs.push(t)},cancel(){this.closeBackground()},async apply(){await this.getSessionId(),this.currentFile.id&&(window.zoomSdk.postJsMessage({functionName:"didChangeHuddleViewBackground",params:{sessionId:this.sessionId},needResponse:!1}),window.zoomSdk.postJsMessage({functionName:"zChatSDKCppAPI_huddleView_applyBackground",params:{type:this.currentFile.type,fileId:this.currentFile.id,sessionId:this.sessionId}}).then((e=>{window.zoomLog({jsFunctionName:"zChatSDKCppAPI_huddleView_applyBackground",params:e}),0!==e.returnCode&&window.zoomSdk.postJsMessage({functionName:"showToast",params:{toast:this.$t("backgroundChangeErrorToast"),type:"warning",sessionId:this.sessionId,autoclose:"1",tickcount:"5000"},needResponse:!1})})).catch((()=>{window.zoomSdk.postJsMessage({functionName:"showToast",params:{toast:this.$t("backgroundChangeErrorToast"),type:"warning",sessionId:this.sessionId,autoclose:"1",tickcount:"5000"},needResponse:!1})}))),this.closeBackground()},closeBackground(){window.zoomSdk.postJsMessage({functionName:"closeAlertWindow",params:{},needResponse:!1})},focusAndMoveArrow(){document.onkeyup=e=>{if(e=e||window.event,console.log(e),"Enter"===e.key){if(document.activeElement&&document.activeElement.getAttribute("data-id")){let e=this.imgs.find((e=>e.id===document.activeElement.getAttribute("data-id")));if(e)return void this.selectImg(e)}if(document.activeElement===this.$refs.addUpLoad)return void this.openUpload()}const t=this.$refs.imgContainer;if(document.activeElement===t||document.activeElement.parentNode===t){let t=this.imgs.length,i=4*(Math.ceil(t/4)-1),s=4*Math.ceil(t/4),a=0;(this.currentFile.localPath.startsWith("/User")||this.currentFile.localPath.startsWith("zmdf:")||this.currentFile.localPath.startsWith("https:")||this.currentFile.localPath.startsWith("http:"))&&(a=this.imgs.findIndex((e=>e.localPath===this.currentFile.localPath))),-1!==a&&("ArrowLeft"===e.key||"Numpad4"===e.key?this.selectImg(this.imgs[(a-1+t)%t]):"ArrowRight"===e.key||"Numpad6"===e.key?this.selectImg(this.imgs[(a+1+t)%t]):"ArrowDown"===e.key||"Numpad7"===e.key?(a+4>=t?(a%=4,setTimeout((()=>{this.$refs.imgContainer.scrollTop=0}),100)):a+=4,this.selectImg(this.imgs[(a+t)%t])):"ArrowUp"!==e.key&&"Numpad5"!==e.key||(a-4<0?(a+i<t?a+=i:a=t-(4-a+s-t),setTimeout((()=>{let e=this.$refs.imgContainer.clientHeight;this.$refs.imgContainer.scrollTop=e}),100)):a-=4,this.selectImg(this.imgs[(a+t)%t])))}}},async indicateBackgroundDownloaded(e){const{jsFunctionName:t,params:i}=e;if("zChatSDKJsAPI_huddleView_indicateBackgroundDownloaded"===t&&this.downLoadReqId&&this.downLoadReqId===i.fileId){const{path:e,fileId:t}=i;this.currentFile.localPath=await this.windowOrMacImagePath(e),this.currentFile.id=t,this.downLoadReqId=""}if("zChatSDKJsAPI_huddleView_indicateBackgroundDownloaded"===t){const{fileId:e,result:t,path:s}=i;0===t?this.imgs.forEach((async t=>{t.id===e&&this.$nextTick((async()=>{t.fakeFileId="",t.localPath=await this.windowOrMacImagePath(s),this.$refs[e][0].src=t.localPath}))})):this.handleErrorImage(e)}},handleErrorImage(e){this.imgs.forEach((t=>{t.id===e&&(t.localPath=i(57009),t.fakeFileId="")}))},indicateCfgBackgroundUpdated(e){const{jsFunctionName:t}=e;"zChatSDKJsAPI_huddleView_indicateCfgBackgroundUpdated"===t&&(this.scrollTop=this.$refs.imgContainer.scrollTop,this.getBackgroundList())},indicateBackgroundDeleted(e){const{jsFunctionName:t,params:i}=e;"zChatSDKJsAPI_huddleView_indicateBackgroundDeleted"===t&&this.deleteFromImgs(i)},deleteFromImgs(e){let{fileId:t}=e;const i=this.imgs.findIndex((e=>e.id===t));if(i>-1&&(this.imgs.splice(i,1),this.currentFile.sourceFileId===t||this.currentFile.sourceFileId===t||this.currentFile.id===t)){let e=this.imgs.find((e=>this.currentBackInfo.appliedFileId===e.id||this.currentBackInfo.sourceFileId===e.id));e&&this.selectImg(e)}},handleBackgroundApplied(e,t,i){const s=this.imgs.filter((i=>i.id===e||i.id===t));s.length>0?this.selectImg(s[0]):this.getSrc(e,i)},isSelected(e,t,i){return e.localPath.startsWith("/User")||e.localPath.startsWith("https:")||e.localPath.startsWith("zmdf:")||e.localPath.startsWith("http:")?(e.sourceFileId===t.id||e.appliedFileId===t.id||e.id===t.id)&&t.id:0===i}},mounted(){this.focusAndMoveArrow()},beforeDestroy(){this.$Bus.$off("zChatSDKJsAPI_huddleView_indicateBackgroundDownloaded",this.indicateBackgroundDownloaded),this.$Bus.$off("zChatSDKJsAPI_huddleView_indicateCfgBackgroundUpdated",this.indicateCfgBackgroundUpdated),this.$Bus.$off("zChatSDKJsAPI_huddleView_indicateBackgroundDeleted",this.indicateBackgroundDeleted)},updated(){}};t.Z=n},96279:function(e,t){t.xk=t.sY=void 0;var i=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"background",style:e.borderStyle,attrs:{"aria-label":"Choose Background, window"}},[t("div",{staticClass:"background--preview"},[t("div",[t("div",{staticClass:"background--preview__title"},[e._v(" "+e._s(e.$t("backgroundTitle"))+" ")]),t("div",{staticClass:"background--preview__tip"},[e._v(" "+e._s(e.$t("backgroundTip"))+" ")])]),t("div",{staticClass:"background--preview__info"},[t("div",{staticStyle:{display:"flex",overflow:"hidden",position:"relative","text-align":"center","border-radius":"12px","align-items":"center","justify-content":"center"}},[t("img",{ref:"img",staticClass:"inline-img",attrs:{draggable:"false",src:e.currentFile.localPath,alt:""},on:{load:e.onLoad}}),t("div",{directives:[{name:"show",rawName:"v-show",value:e.previewValue,expression:"previewValue"}],attrs:{id:"img-container"}})])])]),t("div",{staticStyle:{height:"260px"}},[t("div",{staticClass:"background--selected"},[t("div",{staticClass:"background--selected__options"},[t("zm-checkbox",{attrs:{tabindex:"0"},on:{change:e.handleChange},model:{value:e.previewValue,callback:function(t){e.previewValue=t},expression:"previewValue"}},[e._v(" "+e._s(e.$t("backgroundPreview"))+" ")]),e.showAdd?e._e():t("div",{ref:"addUpLoad",class:["add",{disabled:e.disabled}],attrs:{tabindex:"0","aria-label":e.showErrorMsg?e.$t("backgroundUploadError")+" not clickable":e.disabled?e.getTitle+" not clickable":"add background, button"},on:{click:function(t){return t.stopPropagation(),e.openUpload.apply(null,arguments)}}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.showErrorMsg,expression:"showErrorMsg"}],staticClass:"uploadError"},[t("i",{staticClass:"zm-icon-error-outline"}),e._v(" "+e._s(e.$t("backgroundUploadError"))+" ")]),t("div",{staticClass:"title"},[e._v(e._s(e.getTitle))])])],1),t("div",{ref:"imgContainer",staticClass:"background--selected__imgs",attrs:{"aria-label":"Background list"},on:{scroll:e.handleScroll}},e._l(e.imgs,(function(i,s){return t("div",{directives:[{name:"show",rawName:"v-show",value:!e.loading,expression:"!loading"}],key:i.localPath,ref:i.reqId,refInFor:!0,class:["imgs--container",{isSelected:e.isSelected(e.currentFile,i,s)}],attrs:{title:i.label,"aria-label":`${i.name&&i.name.split(".")[0]}`+(e.isSelected(e.currentFile,i,s)?", selected":""),"data-id":i.id,tabindex:e.isSelected(e.currentFile,i,s)?"0":"-1",role:"option","aria-selected":!0},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.selectImg(i)}}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:i.fakeFileId,expression:"src.fakeFileId"}],staticClass:"image-parent",attrs:{"aria-hidden":"true"}},[e.currentBackInfo.sourceFileId!==i.id&&e.currentBackInfo.appliedFileId!==i.id&&e.currentBackInfo.id!==i.id&&i.id&&i.huddleViewType===e.huddleViewBackgroundType.HuddleView_BackgroundType_PersonalCustom&&!i.fakeFileId?t("div",{staticClass:"delete",on:{click:function(t){return t.stopPropagation(),e.handleDelete(i)}}},[t("i",{staticClass:"zm-icon-error"})]):e._e(),!i.fakeFileId||i.upload?t("img",{ref:i.id,refInFor:!0,staticClass:"background-img",attrs:{draggable:"false",src:i.localPath,alt:i.name&&i.name.split(".")[0],title:i.name&&i.name.split(".")[0],"aria-hidden":"true"},on:{load:function(t){return e.imgLoad(i.localPath)},error:function(t){return e.onError(i)}}}):e._e()])])})),0)])]),t("div",{staticClass:"background--apply"},[t("zm-button",{attrs:{tabindex:"0",plain:"","aria-label":e.$t("backgroundCancel")},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.cancel.apply(null,arguments)}}},[e._v(e._s(e.$t("backgroundCancel")))]),t("zm-button",{attrs:{tabindex:"0",type:"primary","aria-label":e.$t("backgroundApply")},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.apply.apply(null,arguments)}}},[e._v(e._s(e.$t("backgroundApply")))])],1)])};t.sY=i;var s=[];t.xk=s},72602:function(e,t,i){"use strict";e.exports=i.p+"static/img/Office.de8fb10d.jpg"}}]);