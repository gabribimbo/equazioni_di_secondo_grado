(self["webpackChunk_zoom_client_im_js"]=self["webpackChunk_zoom_client_im_js"]||[]).push([[13],{27013:function(e,t,i){"use strict";i.r(t),i.d(t,{__esModule:function(){return n.X},default:function(){return d}});var s=i(73893),n=i(36967),o=n.Z,r=i(1001),a=(0,r.Z)(o,s.sY,s.xk,!1,null,"35038bc0",null),d=a.exports},36967:function(e,t,i){Object.defineProperty(t,"X",{value:!0}),t.Z=void 0;var s=o(i(40766)),n=o(i(84338));function o(e){return e&&e.__esModule?e:{default:e}}var r={data(){return{width:0,height:0,imgContainerClassName:"initial",src:"",loading:!0,hasInsertedImg:!1,fileId:"",downLoadReqId:""}},mixins:[s.default,n.default],methods:{handleError(){this.handleDefaultBg()},confirmMessageSent(e){if(window.zoomLog(e),"zChatSDKJsAPI_confirmMessageSent"===e.jsFunctionName){const{sessionId:t,messageId:i}=e.params;if(this.sessionId!==t)return;t&&i&&this.getMessage(t,i)}},indicateMessageReceived(e){if(window.zoomLog(e),"zChatSDKJsAPI_indicateMessageReceived"===e.jsFunctionName||"zChatSDKJsAPI_indicateEditMessageResult"===e.jsFunctionName||"zChatSDKJsAPI_indicateE2EMessageStateUpdate"===e.jsFunctionName){const{sessionId:t,messageId:i}=e.params;if(this.sessionId!==t)return;t&&i&&this.getMessage(t,i)}},async init(){if(this.resize(),window.addEventListener("resize",this.resize),window.zoomSdk){this.$Bus.$on("positionChange",this.positionChange),this.$Bus.$on("zChatSDKJsAPI_confirmMessageSent",this.confirmMessageSent),this.$Bus.$on("zChatSDKJsAPI_indicateMessageReceived",this.indicateMessageReceived),this.$Bus.$on("zChatSDKJsAPI_indicateEditMessageResult",this.indicateMessageReceived),this.$Bus.$on("zChatSDKJsAPI_indicateE2EMessageStateUpdate",this.indicateMessageReceived),this.$Bus.$on("zChatSDKJsAPI_huddleView_indicateBackgroundDownloaded",this.indicateBackgroundDownloaded),this.$Bus.$on("zChatSDKJsAPI_indicateFTOnSent",this.indicateFTOnSent),this.$Bus.$on("zChatSDKJsAPI_indicateFileShared",this.indicateFileShared),this.$Bus.$on("zChatSDKJsAPI_indicatePrivateStickerSent",this.indicatePrivateStickerSent);const{appliedFileId:e,type:t,sourceFileId:i}=await this.getMemberJids();let s={isApplySource:!1,sourceFileId:"",appliedFileId:""};if(i){const t=await window.zoomSdk.postJsMessage({functionName:"zChatSDKCppAPI_getFileByWebFileId",params:{fileId:i}});if(0===t.returnCode&&t.result.file.isDownloaded){s.sourceFileId=i,s.appliedFileId=e,s.isApplySource=!0;const n=t.result.file.localPath;this.$refs.img&&(this.$refs.img.src=await this.windowOrMacImagePath(n),this.hasInsertedImg=!0),this.fileId=i}}if(!e)return void this.getBackList(s);this.getSrc(e,t,s)}},resize(){const e=window.innerHeight,t=window.innerWidth,i=840,s=592;e<=s&&t<i||t>i&&e<=s||t<=i&&e>s?this.imgContainerClassName="initial":t>i&&e>s&&(i/t>s/e?this.imgContainerClassName="widthFull":i/t<s/e&&(this.imgContainerClassName="heightFull"))},async _useJidCreateUser(e){let{buddy:t,left:i,top:s,jid:n}=e,o=await this.getCanMoveByJid(n);this.$users(n,{sessionId:this.sessionId,ownerJid:this.ownerJid,_buddy:t,_left:i,_top:s,currentJid:n,canMove:o})},_deleteUser(e){this.$users(e,{},"remove")},async updateCanMove(e){let t=this.$users(e,{},"getIsCreated"),i=await this.getCanMoveByJid(e);console.log("updateCanMove",e,i),t&&(t.canMove=i)},async getCanMoveByJid(e){const t=await window.zoomSdk.postJsMessage({functionName:"zChatSDKCppAPI_huddleView_isCanMoveAvatarPosition",params:{sessionId:this.sessionId,buddyJid:e}});console.log("zChatSDKCppAPI_huddleView_isCanMoveAvatarPosition--\x3e",t);let i=!1;return window.zoomLog({jsFunctionName:"zChatSDKCppAPI_huddleView_isCanMoveAvatarPosition",params:t.result}),0===t.returnCode&&(i=t.result.value),i},handleDefaultBg(e){e&&!0===e.isApplySource||this.$nextTick((()=>{this.$refs.img&&(this.$refs.img.src=i(72602)),this.hasInsertedImg=!0}))},async handleBgImg(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(e.isDownloaded){const i=e.localPath;this.$refs.img&&(this.$refs.img.src=await this.windowOrMacImagePath(i),this.hasInsertedImg=!0),this.fileId=t}else this.$refs.img&&!0!==n.isApplySource&&(this.$refs.img.src=i(72602),this.hasInsertedImg=!0),await this.downLoadBackImg(t,s,n),n&&!0===n.isApplySource&&(this.downLoadReqId="")},changePosition(e){let{jid:t,top:i,left:s}=e;this.$users(t,{top:i,left:s},"changePosition")},async indicateBackgroundDownloaded(e){if("zChatSDKJsAPI_huddleView_indicateBackgroundDownloaded"===e.jsFunctionName&&this.downLoadReqId===e.params.reqId){const{path:t,sessionId:i}=e.params;if(i!==this.sessionId)return;this.$refs.img&&(this.$refs.img.src=await this.windowOrMacImagePath(t),this.hasInsertedImg=!0),this.downLoadReqId=""}},getMessage(e,t){e===this.sessionId&&window.zoomSdk.postJsMessage({functionName:"zChatSDKCppAPI_getMessageById",params:{sessionId:e,messageId:t}}).then((e=>{0===e.returnCode&&0===e.returnCode&&(window.zoomLog({jsFunctionName:"zChatSDKCppAPI_getMessageById",params:e.result}),this.resetAvatarIndex(),this.$users(e.result.msg.senderJid,{msg:e.result.msg},"addMessages"))}))},resetAvatarIndex(){for(const e of this.$users.Instance.values())e.setZIndex(0)},indicateFTOnSent(e){if(window.zoomLog(e),"zChatSDKJsAPI_indicateFTOnSent"===e.jsFunctionName){const{sessionId:t,messageId:i,result:s}=e.params;if(0!==s)return;if(this.sessionId!==t)return;t&&i&&this.getMessage(t,i)}},indicateFileShared(e){if(window.zoomLog(e),"zChatSDKJsAPI_indicateFileShared"===e.jsFunctionName){const{sessionId:t,messageId:i,result:s}=e.params;if(0!==s)return;if(this.sessionId!==t)return;t&&i&&this.getMessage(t,i)}},indicatePrivateStickerSent(e){if(window.zoomLog(e),"zChatSDKJsAPI_indicatePrivateStickerSent"===e.jsFunctionName){const{sessionId:t,messageId:i,result:s}=e.params;if(0!==s)return;if(this.sessionId!==t)return;t&&i&&this.getMessage(t,i)}}},computed:{imgContainerStyle(){return{width:this.width+"px",height:this.height+"px"}}},created(){document.title=this.$t("huddleViewtitle")},async mounted(){this.init(),this.focusAndMoveArrow()},beforeDestroy(){this.$Bus.$off("positionChange",this.positionChange),this.$Bus.$off("zChatSDKJsAPI_confirmMessageSent",this.confirmMessageSent),this.$Bus.$off("zChatSDKJsAPI_indicateMessageReceived",this.indicateMessageReceived),this.$Bus.$off("zChatSDKJsAPI_indicateEditMessageResult",this.indicateMessageReceived),this.$Bus.$off("zChatSDKJsAPI_indicateE2EMessageStateUpdate",this.indicateMessageReceived),this.$Bus.$off("zChatSDKJsAPI_huddleView_indicateBackgroundDownloaded",this.indicateBackgroundDownloaded),this.$Bus.$off("zChatSDKJsAPI_indicateFTOnSent",this.indicateFTOnSent),this.$Bus.$off("zChatSDKJsAPI_indicateFTOnSent",this.indicateFileShared),this.$Bus.$off("zChatSDKJsAPI_indicatePrivateStickerSent",this.indicatePrivateStickerSent)}};t.Z=r},73893:function(e,t){t.xk=t.sY=void 0;var i=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],class:["app",{hasInsertedImg:e.hasInsertedImg}],attrs:{id:"rect","aria-label":"Huddle View Area, use arrow keys to select participant, and space to begin interacting",tabindex:"-1"}},[t("div",{class:["img--container",e.imgContainerClassName]},[t("div",{class:[e.imgContainerClassName],staticStyle:{display:"inline-block",overflow:"hidden",position:"relative"},attrs:{id:"container"}},[t("img",{ref:"img",class:[e.imgContainerClassName,"bgImg"],staticStyle:{display:"block"},attrs:{draggable:"false",tabindex:"-1","aria-hidden":"true"},on:{load:e.onLoad,error:e.handleError}})])])])};t.sY=i;var s=[];t.xk=s},84338:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var s=i(89334);const n=2;var o={data(){return{posMatrix:[],xLength:0,yLength:0,currentActive:{jid:"",xAxis:0,yAxis:0}}},mounted(){this.$Bus.$on("selectCurrentUser",this.selectCurrentUser)},beforeDestroy(){this.$Bus.$off("selectCurrentUser",this.selectCurrentUser),document.removeEventListener("keydown",this.keyDownEvent)},methods:{selectCurrentUser(e){e&&e.jid&&this.setActiveUser(e.jid)},focusAndMoveArrow(){document.addEventListener("keydown",this.keyDownEvent)},keyDownEvent(e){if(console.log("event",e),!0!==e.shiftKey||"ArrowLeft"!==e.key)if(!0!==e.shiftKey||"ArrowUp"!==e.key)if(!0!==e.shiftKey||"ArrowRight"!==e.key){if(!0!==e.shiftKey||"ArrowDown"!==e.key)return"ArrowLeft"===e.key?(this.getCurrentFocus(),this.getPositionMatrix(),void this.selectToLeft()):"ArrowUp"===e.key?(this.getCurrentFocus(),this.getPositionMatrix(),void this.selectToUp()):"ArrowRight"===e.key?(this.getCurrentFocus(),this.getPositionMatrix(),void this.selectToRight()):"ArrowDown"===e.key?(this.getCurrentFocus(),this.getPositionMatrix(),void this.selectToDown()):void("Enter"!==e.key?"Escape"!==e.key||this.hideCard():this.showCard());this.moveToDown()}else this.moveToRight();else this.moveToUp();else this.moveToLeft()},getCurrentFocus(){var e;let t=(null===(e=document.activeElement)||void 0===e?void 0:e.getAttribute("data-jid"))||"";t&&t!==this.currentActive.jid&&(this.currentActive.jid=t)},moveToLeft(){const{width:e}=document.querySelector("#container").getBoundingClientRect();let{left:t,top:i,width:s,height:o}=this.getCurrentPosByJid();"undefined"!==typeof t&&(t=(t*e-n)/e,this.setPosition(this.currentActive.jid,{left:t,top:i,width:s,height:o}))},moveToRight(){const{width:e}=document.querySelector("#container").getBoundingClientRect();let{left:t,top:i,width:s,height:o}=this.getCurrentPosByJid();"undefined"!==typeof t&&(t=(t*e+n)/e,this.setPosition(this.currentActive.jid,{left:t,top:i,width:s,height:o}))},moveToUp(){const{height:e}=document.querySelector("#container").getBoundingClientRect();let{left:t,top:i,width:s,height:o}=this.getCurrentPosByJid();"undefined"!==typeof i&&(i=(i*e-n)/e,this.setPosition(this.currentActive.jid,{left:t,top:i,width:s,height:o}))},moveToDown(){const{height:e}=document.querySelector("#container").getBoundingClientRect();let{left:t,top:i,width:s,height:o}=this.getCurrentPosByJid();"undefined"!==typeof i&&(i=(i*e+n)/e,this.setPosition(this.currentActive.jid,{left:t,top:i,width:s,height:o}))},getCurrentPosByJid(){var e;if(!this.currentActive||!this.currentActive.jid)return{};let t=(null===(e=document.activeElement)||void 0===e?void 0:e.getAttribute("data-jid"))||"",i="";if(console.log("jid",document.activeElement,t),t&&t!==this.currentActive.jid?(this.setActiveUser(t),i=this.$users.Instance.get(t)):i=this.$users.Instance.get(this.currentActive.jid),!i)return{};if(!i.canMove)return{};let{width:s,height:n}=i.$el.getBoundingClientRect(),{left:o,top:r}=i;return{left:o,top:r,width:s,height:n}},async setPosition(e,t){let{left:i,top:n,width:o,height:r}=t;const{height:a,width:d}=document.querySelector("#container").getBoundingClientRect(),h=o/2/d,c=r/2/a,u=(d-o)/d,l=(a-r)/a;let g=i<h?h:i>=u+h?u+h:i,f=n<c?c:n>=l+c?l+c:n;window.zoomSdk.postJsMessage({functionName:"zChatSDKCppAPI_huddleView_moveAvatarPosition",params:{sessionId:this.sessionId,buddyJid:e,avatarPosition:{x:{n:Math.ceil(840*g),d:840},y:{n:Math.ceil(592*f),d:592}}}}).then((t=>{if(0===t.returnCode){this.$users(e,{top:f,left:g},"changeDataValue");let t=Math.ceil(d*(u+h-g)),i=Math.ceil(a*(l+c-f));(0,s.speakAnnoce)(`${t} pixels from right edge, ${i} pixels from bottom edge.`),setTimeout((()=>{let e=this.$users.Instance.get(this.currentActive.jid);e.$el.focus()}),500)}}))},selectToLeft(){this.findSamePostionPrev();for(let e=this.currentActive.yAxis-1;e>=0;e--){let t=this.posMatrix[this.currentActive.xAxis][e];if(t&&t.length)return void this.setValue(t[t.length-1],this.currentActive.xAxis,e)}this.findPrevLine()},selectToUp(){this.findSamePostionPrev();for(let e=this.currentActive.xAxis-1;e>=0;e--){let t=this.posMatrix[e][this.currentActive.yAxis];if(t&&t.length)return void this.setValue(t[t.length-1],e,this.currentActive.yAxis)}this.findPrevLine()},selectToRight(){if(!this.findSamePostionNext()){for(let e=this.currentActive.yAxis+1;e<this.xLength;e++){let t=this.posMatrix[this.currentActive.xAxis][e];if(t&&t.length)return void this.setValue(t[0],this.currentActive.xAxis,e)}this.findNextLine()}},selectToDown(){if(!this.findSamePostionNext()){for(let e=this.currentActive.xAxis+1;e<this.yLength;e++){let t=this.posMatrix[e][this.currentActive.yAxis];if(t&&t.length)return void this.setValue(t[0],e,this.currentActive.yAxis)}this.findNextLine()}},findSamePostionPrev(){let e=this.posMatrix[this.currentActive.xAxis][this.currentActive.yAxis];if(e&&e.length>1){let t=e.findIndex((e=>e.jid===this.currentActive.jid));if(t>0)return this.setValue(e[t-1],this.currentActive.xAxis,this.currentActive.yAxis),!0}return!1},findSamePostionNext(){let e=this.posMatrix[this.currentActive.xAxis][this.currentActive.yAxis];if(e&&e.length>1){let t=e.findIndex((e=>e.jid===this.currentActive.jid));if(t<e.length-1)return this.setValue(e[t+1],this.currentActive.xAxis,this.currentActive.yAxis),!0}return!1},findPrevLine(){for(let e=this.currentActive.xAxis-1;e>=0;e--)for(let t=this.xLength-1;t>=0;t--){let i=this.posMatrix[e][t];if(i&&i.length>0)return void this.setValue(i[i.length-1],e,t)}},findNextLine(){for(let e=this.currentActive.xAxis+1;e<this.yLength;e++)for(let t=0;t<this.xLength;t++){let i=this.posMatrix[e][t];if(i&&i.length>0)return void this.setValue(i[i.length-1],e,t)}},getPositionMatrix(){const{height:e,width:t}=document.querySelector("#container").getBoundingClientRect();let i=[],s=1;this.xLength=Math.ceil(t/60),this.yLength=Math.ceil(e/60),i=new Array(this.yLength).fill([],0,this.yLength),i=i.map((()=>new Array(this.xLength).fill([],0,this.xLength)));for(const n of this.$users.Instance.values()){let o=e*n.top,r=t*n.left,a=Math.floor(r/60),d=Math.floor(o/60),h={jid:n.buddy.jid,top:o,posIndex:s++};i[d][a]&&i[d][a].length>0?(i[d][a].push(h),i[d][a]=i[d][a].sort(((e,t)=>e.top-t.top))):i[d][a]=[h],this.currentActive.jid===n.buddy.jid&&(this.currentActive.xAxis=d,this.currentActive.yAxis=a)}this.posMatrix=i},setActiveUser(e){this.getPositionMatrix(),this.posMatrix.some(((t,i)=>{if(t){let s=t.some(((t,s)=>{if(t&&t.length){let n=t.find((t=>t.jid===e));return!!n&&(this.setValue(t[0],i,s),!0)}}));return s}return!1}))},setValue(e,t,i){this.$users(this.currentActive.jid,{isKeyActive:!1,ariaChecked:!1},"changeDataValue"),this.currentActive={jid:e.jid,xAxis:t,yAxis:i};let s=[...this.$users.Instance].length;this.$users(this.currentActive.jid,{isKeyActive:!0,ariaIndex:e.posIndex,ariaTotal:s},"changeDataValue");let n=this.$users.Instance.get(this.currentActive.jid);setTimeout((()=>{n.$el.focus()}),0)},async showCard(){var e;if(!this.currentActive.jid)return;let t=(null===(e=document.activeElement)||void 0===e?void 0:e.getAttribute("data-jid"))||"",i="";if(t&&t!==this.currentActive.jid?(this.setActiveUser(t),i=this.$users.Instance.get(t)):i=this.$users.Instance.get(this.currentActive.jid),!i)return;const{left:s,top:n,width:o,height:r}=i.$el.getBoundingClientRect(),a=document.querySelector("#rect");console.log("this.currentActive",this.currentActive,s,n,o,r,a),window.zoomSdk.postJsMessage({functionName:"showVCard",params:{jid:this.currentActive.jid,rect:`(${s},${n},${o},${r})`,offset:`(${a.scrollLeft},${a.scrollTop})`,autoClose:"0"},needResponse:!1})},hideCard(){window.zoomSdk.postJsMessage({functionName:"closeVCard",params:{jid:this.currentActive.jid},needResponse:!1})}}};t["default"]=o},72602:function(e,t,i){"use strict";e.exports=i.p+"static/img/Office.de8fb10d.jpg"}}]);