"use strict";(self["webpackChunk_zoom_client_email_desktop"]=self["webpackChunk_zoom_client_email_desktop"]||[]).push([[718],{83718:function(e,t,a){a.r(t),a.d(t,{default:function(){return y},getFormatUtcDateTime:function(){return E}});var n=function(){var e=this,t=e._self._c;return e.visible?t("section",{ref:"calendarCardRef",staticClass:"calendar-card",attrs:{tabindex:"0","aria-label":e.ariaLabel},on:{click:function(t){return t.stopPropagation(),e.openCalendarEventDetail.apply(null,arguments)},keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"space",32,t.key,[" ","Spacebar"])?null:(t.stopPropagation(),t.preventDefault(),e.openCalendarEventDetail.apply(null,arguments))},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.stopPropagation(),t.preventDefault(),e.openCalendarEventDetail.apply(null,arguments))}]}},[t("div",{staticClass:"calendar-card__main"},[t("div",{staticClass:"calendar-card__main__left"},[t("svg-icon",{staticClass:"calendar-card__main__logo",attrs:{iconClass:"calendar",className:"system-icon","aria-hidden":"true"}})],1),t("div",{staticClass:"calendar-card__main__center"},[t("div",{staticClass:"calendar-card__text calendar-card__main__summary"},[e._v(" "+e._s(e.detail.summary||"(Unknown)")+" ")]),e.eventStatus?t("div",{class:["calendar-card__main__event",e.eventStatus.className]},[t("span",[e._v(e._s(e.eventStatus.text))])]):e._e(),e.useSimpleMode?e._e():[t("div",{staticClass:"calendar-card__text calendar-card__main__date"},[t("span",[e._v(e._s(e.formatCalendarDate(e.detail.startTime)))]),e.detail.isAllDayEvent?e._e():[t("span",[e._v(", ")]),e._v(" "+e._s(e.formatCalendarTime(e.detail.startTime,e.detail.endTime,e.detail.crossDay))+" ")]],2),t("div",{staticClass:"calendar-card__text calendar-card__main__attendees"},[t("span",[e._v(e._s(e.attendeesText))]),e.otherAttendeesCount>0?[t("span",[e._v(", ")]),t("span",{staticClass:"calendar-card__link"},[e._v(" + "+e._s(e.otherAttendeesCount)+" "+e._s(e.otherAttendeesCount>1?e.$t("calendar.others"):e.$t("calendar.other"))+" ")])]:e._e()],2),t("div",{directives:[{name:"show",rawName:"v-show",value:e.physicalLocation.length,expression:"physicalLocation.length"}],staticClass:"calendar-card__text calendar-card__main__location"},[t("svg-icon",{staticClass:"calendar-card__icon",attrs:{iconClass:"calendar-location",className:"system-icon","aria-hidden":"true"}}),t("span",[e._v(e._s(e.physicalLocation))])],1),e.detail.canJoin&&e.detail.meetingUrl?t("div",{staticClass:"calendar-card__text calendar-card__main__meeting"},[e.joinButtonVisible?t("zm-button",{staticClass:"calendar-card__main__meeting__button",attrs:{href:e.detail.meetingUrl,type:"primary",size:"small",tabindex:"0",role:"button"}},[e._v(" "+e._s(e.$t("calendar.joinMeeting"))+" ")]):[t("svg-icon",{staticClass:"calendar-card__icon",attrs:{iconClass:"calendar-meeting",className:"system-icon","aria-hidden":"true"}}),t("a",{staticClass:"tab-focus",attrs:{tabindex:"0",href:e.detail.meetingUrl,role:"button"}},[e._v(" "+e._s(e.$t("calendar.meeting"))+" ")])]],2):e._e()]],2),t("div",{class:["calendar-card__main__right",!e.conflictMeetingsVisible&&"calendar-card__main__right--hidden"]},[t("div",{class:["calendar-card__main__conflict",e.conflictMeetingsVisible&&"calendar-card__main__conflict--show"]},[t("section",{staticClass:"calendar-card__main__conflict__title"},[t("svg-icon",{attrs:{iconClass:"alert","aria-hidden":"true"}}),t("span",{staticClass:"calendar-card__subtext"},[e._v(e._s(e.$t("calendar.conflictMeeting")))])],1),e._l(e.limitedConflictMeetings,(function(a,n){return t("section",{key:a.eventId,ref:"conflictEvents",refInFor:!0,staticClass:"calendar-card__main__conflict__event",attrs:{"aria-hidden":"true"},on:{click:function(t){return t.stopPropagation(),e.openConflictingEventDetail(a.eventId,n)},keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"space",32,t.key,[" ","Spacebar"])?null:(t.stopPropagation(),t.preventDefault(),e.openConflictingEventDetail(a.eventId,n))},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.stopPropagation(),t.preventDefault(),e.openConflictingEventDetail(a.eventId,n))}]}},[t("span",{staticClass:"calendar-card__subtext calendar-card__main__conflict__event__time"},[e._v(" "+e._s(e.transformISODateToString(a.startTime))+" ")]),t("span",{staticClass:"calendar-card__subtext calendar-card__main__conflict__event__summary"},[e._v(" "+e._s(a.summary)+" ")])])}))],2)])]),e.isMyOwnCalendarEvent||e.useSimpleMode||!e.detail.canResponse?e._e():t("div",{staticClass:"calendar-card__response"},[t("div",{staticClass:"calendar-card__response__divider"}),t("div",{staticClass:"calendar-card__response__container"},[t("div",{staticClass:"calendar-card__response__buttons"},[t("span",{staticClass:"calendar-card__response__tip"},[e._v(e._s(e.$t("calendar.actionTip")))]),t("zm-button",{class:["calendar-card__response__button--yes","primary"===e.formatCalendarStatus(e.finalStatus,e.RESPONSE_TYPE.YES)&&"calendar-card__response__button--selected"],attrs:{type:e.formatCalendarStatus(e.finalStatus,e.RESPONSE_TYPE.YES),size:"small",tabindex:"0","aria-label":"".concat(e.$t("calendar.actionTip"),", ").concat(e.$t("calendar.statusYes")),round:""},on:{click:function(t){return t.stopPropagation(),e.handleCalendarResponse(e.RESPONSE_TYPE.YES)}}},[e._v(" "+e._s(e.$t("calendar.statusYes"))+" ")]),t("zm-button",{class:["calendar-card__response__button--no","primary"===e.formatCalendarStatus(e.finalStatus,e.RESPONSE_TYPE.NO)&&"calendar-card__response__button--selected"],attrs:{type:e.formatCalendarStatus(e.finalStatus,e.RESPONSE_TYPE.NO),size:"small",tabindex:"0",round:""},on:{click:function(t){return t.stopPropagation(),e.handleCalendarResponse(e.RESPONSE_TYPE.NO)}}},[e._v(" "+e._s(e.$t("calendar.statusNo"))+" ")]),t("zm-button",{class:["calendar-card__response__button--maybe","primary"===e.formatCalendarStatus(e.finalStatus,e.RESPONSE_TYPE.MAYBE)&&"calendar-card__response__button--selected"],attrs:{type:e.formatCalendarStatus(e.finalStatus,e.RESPONSE_TYPE.MAYBE),size:"small",tabindex:"0",round:""},on:{click:function(t){return t.stopPropagation(),e.handleCalendarResponse(e.RESPONSE_TYPE.MAYBE)}}},[e._v(" "+e._s(e.$t("calendar.statusMaybe"))+" ")])],1)])])]):e._e()},i=[],r=a(70021),s=a(56706),l=a(34948),c=(a(77950),a(85940),a(75704),a(43430),a(71639),a(29648)),d=a(37761),o=a(83264),u=a(3346),_=a(63012),m=a(21942),f=4,p=3,v=u.Enums.Notification,h=u.Business.timeShift;function E(e,t,a){var n=o.ou.fromMillis(1e3*e,{zone:a}),i=o.ou.fromMillis(1e3*t,{zone:a}),r=i.diff(n,"hours").toObject(),s=r.hours,l=o.ou.fromMillis(1e3*e,{zone:a}).toISODate(),c=o.ou.fromMillis(1e3*e,{zone:a}).plus({day:Math.ceil(s/24)}).toISODate(),d=o.ou.utc().setZone(a).set({hour:0,minute:0,seconds:0,milliseconds:0}).toISOTime({suppressMilliseconds:!0,includePrefix:!0});return{startTime:"".concat(l).concat(d),endTime:"".concat(c).concat(d)}}var C={name:"CalendarCard",components:{SvgIcon:m.Z},props:{msgId:{type:String,required:!0},calendarId:{type:String,required:!0},calendarType:{type:String,default:"None"}},data:function(){return{RESPONSE_TYPE:{YES:this.$t("calendar.statusYes"),MAYBE:this.$t("calendar.statusMaybe"),NO:this.$t("calendar.statusNo")},EVENT_STATUS:{CHANGED:{text:this.$t("calendar.eventChanged"),className:"calendar-card__main__event--primary"},UPCOMING:{text:this.$t("calendar.eventUpcoming"),className:"calendar-card__main__event--info"},OUT_OF_DATE:{text:this.$t("calendar.eventOutOfDate"),className:"calendar-card__main__event--plain"},CANCELED:{text:this.$t("calendar.eventCanceled"),className:"calendar-card__main__event--danger"},ACCEPTED:{text:this.$t("calendar.eventAccepted"),className:"calendar-card__main__event--primary"},DECLINED:{text:this.$t("calendar.eventDeclined"),className:"calendar-card__main__event--danger"},RESPONDED_MAYBE:{text:this.$t("calendar.eventRespondedMaybe"),className:"calendar-card__main__event--info"}},visible:!1,detail:{eventId:"",conferenceId:"",summary:"",startTime:0,endTime:0,createdTime:0,updatedTime:0,isAllDayEvent:!1,crossDay:!1,location:"",meetingUrl:"",isCanceled:!1,canResponse:!1,canJoin:!1,organizer:{displayName:"",email:""},attendees:[],isRecurring:!1},finalStatus:"",requesting:!1,conflictMeetings:[]}},computed:(0,l.Z)((0,l.Z)((0,l.Z)({},(0,c.rn)({userEmail:function(e){return e.userProfile.userEmail||""},userTimeZone:function(e){return e.userProfile.userTimeZone},isDelegated:function(e){return e.userProfile.isDelegated}})),(0,c.rn)("auth",["isMailBetaFeatureEnabled"])),{},{enabled:function(e){var t=e.calendarType;return"None"!==t},isMyOwnCalendarEvent:function(e){var t=e.detail,a=e.userEmail;return t.organizer.email===a},limitedAttendeesListLength:function(e){var t=e.isMyOwnCalendarEvent;return t?f:f-1},limitedAttendeesList:function(e){var t=e.detail,a=e.limitedAttendeesListLength,n=e.userEmail;return(null===t||void 0===t?void 0:t.attendees.filter((function(e){return e.email!==t.organizer.email})).filter((function(e){return e.email!==n})).slice(0,a))||[]},attendeesText:function(e){var t=e.detail,a=e.limitedAttendeesList,n=e.isMyOwnCalendarEvent,i=e.getDisplayName,r=a.map((function(e){return e.displayName||i(e.email)})),s=n?"":t.organizer.displayName;return s.length?r.length?s.concat(", ",r.join(", ")):s:r.join(", ")},otherAttendeesCount:function(e){var t=e.detail,a=e.isMyOwnCalendarEvent,n=e.limitedAttendeesListLength;return a?t.attendees.length-1-n:t.attendees.length-2-n},physicalLocation:function(e){var t=e.detail;return t.location.replaceAll(t.meetingUrl,"")},isExpired:function(e){var t=e.detail;return o.ou.now().minus({minutes:15}).toSeconds()>t.endTime&&!t.isRecurring},eventStatus:function(e){var t=e.detail,a=e.isMyOwnCalendarEvent,n=e.isExpired,i=e.finalStatus;if(t.isCanceled)return this.EVENT_STATUS.CANCELED;if(n)return this.EVENT_STATUS.OUT_OF_DATE;if(o.ou.now().plus({hours:1}).toSeconds()>t.startTime&&o.ou.now().toSeconds()<t.startTime)return this.EVENT_STATUS.UPCOMING;if(!a){if(i===this.RESPONSE_TYPE.YES)return this.EVENT_STATUS.ACCEPTED;if(i===this.RESPONSE_TYPE.NO)return this.EVENT_STATUS.DECLINED;if(i===this.RESPONSE_TYPE.MAYBE)return this.EVENT_STATUS.RESPONDED_MAYBE}return-1!==t.createdTime&&t.createdTime!==t.updatedTime?this.EVENT_STATUS.CHANGED:null},joinButtonVisible:function(e){var t=e.detail;return o.ou.now().plus({minutes:15}).toSeconds()>=t.startTime&&o.ou.now().minus({minutes:15}).toSeconds()<=t.endTime},useSimpleMode:function(e){var t=e.detail,a=e.isExpired;return!(!t.isCanceled&&!a)},ariaLabel:function(e){var t=this,a=e.conflictMeetingsVisible,n=e.detail,i=e.eventStatus,r=e.attendeesText,s=e.limitedConflictMeetings,l="".concat(n.summary,", ").concat(i?"".concat(i.text,", "):"").concat("".concat(this.formatCalendarTime(n.startTime,n.endTime,n.crossDay),", ").concat(r,", ").concat(this.$t("calendar.pressTip")));return a&&(l=l.concat(this.$t("calendar.conflictMeeting")).concat(s.map((function(e,a){return[a+1,t.transformISODateToString(e.startTime),e.summary].join(", ")})))),l},limitedConflictMeetings:function(e){var t=e.detail,a=e.conflictMeetings,n=a.filter((function(e){return t.startTime<o.ou.fromISO(e.endTime,{setZone:!0}).toSeconds()&&t.endTime>o.ou.fromISO(e.startTime,{setZone:!0}).toSeconds()}));return n.slice(0,p)},conflictMeetingsVisible:function(e){var t=e.detail,a=e.isExpired,n=e.limitedConflictMeetings;return!t.isCanceled&&!a&&n.length>0}}),watch:{"detail.endTime":{handler:function(e){e<=0||this.getConflictMeetingData()},deep:!0},"detail.startTime":{handler:function(e){e<=0||this.getConflictMeetingData()},deep:!0}},created:function(){this.applyHandleCalendarEventUpdate(),this.applyHandleConflictingEventsChange()},mounted:function(){var e=this;return(0,s.Z)((0,r.Z)().mark((function t(){return(0,r.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.enabled&&e.getCalendarEventDetail();case 1:case"end":return t.stop()}}),t)})))()},methods:{formatCalendarDate:function(e){return h().tz(1e3*e,this.userTimeZone).format("dddd, MMMM D")},formatCalendarTime:function(e,t,a){var n=h().tz(1e3*e,this.userTimeZone).format("h:mm A"),i=h().tz(1e3*t,this.userTimeZone).format("h:mm A");return a?n:"".concat(n," - ").concat(i)},formatCalendarStatus:function(e,t){return e===String(t)?"primary":"default"},getDisplayName:function(e){return e.split("@")[0].split(".").map(d.capitalize).join(" ")},processCalendarEventData:function(e){var t=this;this.detail.eventId=e.calendarEventId,this.detail.conferenceId=e.conference_id,this.detail.summary=(null===e||void 0===e?void 0:e.summary)||"(None)",this.detail.startTime=e.startTime,this.detail.endTime=e.endTime,this.detail.createdTime=e.createdTime,this.detail.updatedTime=e.lastModifyTime,this.detail.isAllDayEvent=e.isAllDayEvent,this.detail.isCanceled=e.isCanceled,this.detail.canResponse=e.bCanResponse,this.detail.canJoin=!(null===e||void 0===e||!e.bCanJoin),this.detail.location=(null===e||void 0===e?void 0:e.location)||"",this.detail.meetingUrl=(null===e||void 0===e?void 0:e.meetingUrl)||"",this.detail.organizer={displayName:(null===e||void 0===e?void 0:e.organizerDisplayName)||this.getDisplayName(e.organizerEmail),email:e.organizerEmail},this.detail.attendees=e.attendees,this.detail.isRecurring=e.isRecurring;var a=h().tz(e.startTime,this.userTimeZone),n=h().tz(e.endTime,this.userTimeZone);this.detail.crossDay=!a.isSame(n,"date");var i=e.attendees.find((function(e){return e.email===t.userEmail}));i&&(this.finalStatus=i.respStatus.respStatus)},getCalendarEventDetail:function(){var e=this;return(0,s.Z)((0,r.Z)().mark((function t(){var a;return(0,r.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.calendarId){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,_.Calendar.getCalendarEventDetail({calendarId:e.calendarId});case 4:a=t.sent,a&&(e.processCalendarEventData(a),e.visible=!0);case 6:case"end":return t.stop()}}),t)})))()},getConflictMeetingData:function(){var e=arguments,t=this;return(0,s.Z)((0,r.Z)().mark((function a(){var n,i,s,l,c,d;return(0,r.Z)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n=e.length>0&&void 0!==e[0]&&e[0],t.isMailBetaFeatureEnabled){a.next=3;break}return a.abrupt("return");case 3:if(!(t.detail.startTime<=0||t.detail.endTime<=0||t.requesting)){a.next=5;break}return a.abrupt("return");case 5:if(t.requesting=!0,i=E(t.detail.startTime,t.detail.endTime,t.userTimeZone),s=i.startTime,l=i.endTime,c={calendarId:t.userEmail,end:{dateTime:l,timeZone:t.userTimeZone},start:{dateTime:s,timeZone:t.userTimeZone}},!n){a.next=14;break}return a.next=11,_.Calendar.getEventsAndMeetingsByDay(c);case 11:a.t0=a.sent,a.next=17;break;case 14:return a.next=16,_.Calendar.listEventsAndMeetingsByDay(c);case 16:a.t0=a.sent;case 17:d=a.t0,d&&Array.isArray(d)&&(t.conflictMeetings=d.filter((function(e){return e.eventId!==t.detail.eventId&&e.meetingNo!==t.detail.conferenceId&&!e.isCanceled&&o.ou.now().toSeconds()<o.ou.fromISO(e.endTime,{setZone:!0}).toSeconds()})).sort((function(e,t){return o.ou.fromISO(e.startTime,{setZone:!0}).toMillis()-o.ou.fromISO(t.startTime,{setZone:!0}).toMillis()}))),t.requesting=!1;case 20:case"end":return a.stop()}}),a)})))()},handleCalendarResponse:function(e){var t=this;return(0,s.Z)((0,r.Z)().mark((function a(){var n;return(0,r.Z)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.finalStatus=e,a.next=3,_.Calendar.responseCalendarEvent({calendarId:t.calendarId,respStatus:e});case 3:n=a.sent,n&&(t.finalStatus=n,t.enabled&&t.getCalendarEventDetail());case 5:case"end":return a.stop()}}),a)})))()},applyHandleCalendarEventUpdate:function(){var e=this,t=function(t){var a=t.result,n=a.calendarEventDetail,i=a.msgId;i&&i!==e.msgId||n.caldId===e.calendarId&&e.processCalendarEventData(n)};this.$Bus.$on(v.OnCalendarEventUpdate,t),this.$once("hook:beforeDestroy",(function(){e.$Bus.$off(v.OnCalendarEventUpdate,t)}))},applyHandleConflictingEventsChange:function(){var e=this;if(this.isMailBetaFeatureEnabled){var t=function(t){var a=t.result.SinkCalendarNotification;(null===a||void 0===a?void 0:a.CalendarId)===e.userEmail&&e.getConflictMeetingData(!0)};this.$Bus.$on(v.OnCalendarEventsAndMeetingsChanged,t),this.$once("hook:beforeDestroy",(function(){e.$Bus.$off(v.OnCalendarEventsAndMeetingsChanged,t)}))}},openCalendarEventDetail:function(){if(!this.isDelegated){var e=this.$refs.calendarCardRef.getBoundingClientRect(),t=e.width,a=e.height,n=e.left,i=e.top,r={calendarId:"primary",eventId:this.detail.eventId,fromMail:!0,rect:"(".concat(n,",").concat(i+a/2,",").concat(t,",").concat(a,")")};_.Calendar.viewCalendarEventDetail(r)}},openConflictingEventDetail:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.isDelegated&&e){var a=this.$refs.conflictEvents[t].getBoundingClientRect(),n=a.width,i=a.height,r=a.left,s=a.top,l={calendarId:"primary",eventId:e,fromMail:!0,rect:"(".concat(r,",").concat(s+i/2,",").concat(n,",").concat(i,")")};_.Calendar.viewCalendarEventDetail(l)}},transformISODateToString:function(e){return h().tz(o.ou.fromISO(e,{setZone:!0}).toMillis(),this.userTimeZone).format("h:mm A")}}},g=C,T=a(93483),S=(0,T.Z)(g,n,i,!1,null,"09ba049b",null),y=S.exports}}]);